SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROC [dbo].[CO_SP_SELECT_REPORTE_DOCUMENTO_VENTA]
@CO_EMP_RUC CHAR(13)
,@CO_DOC_VEN_NUM NVARCHAR(20) 
,@CO_TIP_DOC_VEN_NUM INT

AS
declare @agrupar bit
select @agrupar=[CO_TIP_DOC_VEN_AGR_PRO] from CO_TIPO_DOCUMENTO_VENTA where [CO_TIP_DOC_VEN_NUM]=@CO_TIP_DOC_VEN_NUM
print @agrupar
if @agrupar=0
begin
	SELECT [CO_CLI_NOM]
		  ,[CO_CLI_COD]
		  ,[CO_CLI_CED]
		  ,[CO_CLI_TEL]
		  ,[CO_CLI_DIR]
		  ,[CO_CLI_CIU]
		  ,[CO_CLI_MAI]
		  ,[CO_DOC_VEN_FEC]
		  ,[CO_DOC_VEN_FOR_PAG]
		  ,[CO_DOC_VEN_TOT_LET]
		  ,[CO_DOC_VEN_TOT_NET]
		  ,[CO_DOC_VEN_POR_DES]
		  ,[CO_DOC_VEN_DES]
		  ,[CO_DOC_VEN_POR_IVA]
		  ,[CO_DOC_VEN_IVA]
		  ,[CO_DOC_VEN_TOT_PAG]
		  ,[CO_DOC_VEN_GUI_NUM]
		  ,[CO_DOC_VEN_GUI_FEC_INI]
		  ,[CO_DOC_VEN_GUI_FEC_TER]
		  ,[CO_DOC_VEN_GUI_TIP]
		  ,[CO_DOC_VEN_GUI_NOM_TRA]
		  ,[CO_DOC_VEN_GUI_IDE]
		  ,[CO_EMP_RUC]
		  ,[CO_DOC_VEN_NUM]
		  ,[CO_TIP_DOC_VEN_NUM]
		  ,[CO_DET_DOC_VEN_ART_COD]
		  ,[CO_DET_DOC_VEN_ART_NOM]
		  ,[CO_DET_DOC_VEN_CAN]
		  ,[CO_DET_DOC_VEN_PRE]
		  ,[CO_DET_DOC_VEN_TOT]
		  ,[CO_EMP_NOM]
		  ,[CO_EMP_CIU]
		  ,[CO_EMP_DIR]
		  ,[CO_DOC_VEN_VAL_IVA0]
		  ,[CO_VEN_NOM]
		  ,[CO_DET_DOC_VEN_ART_BAR]
		  ,[CO_DOC_VEN_OTR]
		  ,[CO_DOC_VEN_DET]
		  ,[CO_CANTIDAD_EMPAQUE]
		  ,[CO_EMPRESA_LOGO]
		  ,[CO_OBLIGADO_CONTABILIDAD]
		  ,[CO_CONTRIBUYENTE_ESPECIAL]
		  ,[CO_CONTRIBUYENTE_NUMERO]
		  ,[CO_EMP_RAZ_SOC]
		  ,[CO_DET_DOC_VEN_DES]
		  ,[CO_CODIGO_BARRAS_FACT_ELECTRONICA]
		  ,[CO_CLAVE_ACCESO_FACT_ELECTRONICA]
		  ,[CO_FECHA_AUTORIZA_FACT_ELECTRONICA]
		  ,[CO_DOC_VEN_MOD_NUM]
		  ,[CO_DOC_VEN_FEC_MOD]
		  ,CO_EMP_TEL
	FROM CO_VW_SELECT_REPORTE_DOCUMENTO_VENTA
	WHERE CO_EMP_RUC=@CO_EMP_RUC AND CO_DOC_VEN_NUM=@CO_DOC_VEN_NUM AND CO_TIP_DOC_VEN_NUM=@CO_TIP_DOC_VEN_NUM
	ORDER BY [CO_DET_DOC_VEN_ART_COD]
end
else
begin
	SELECT [CO_CLI_NOM]
		  ,[CO_CLI_COD]
		  ,[CO_CLI_CED]
		  ,[CO_CLI_TEL]
		  ,[CO_CLI_DIR]
		  ,[CO_CLI_CIU]
		  ,[CO_CLI_MAI]
		  ,[CO_DOC_VEN_FEC]
		  ,[CO_DOC_VEN_FOR_PAG]
		  ,[CO_DOC_VEN_TOT_LET]
		  ,[CO_DOC_VEN_TOT_NET]
		  ,[CO_DOC_VEN_POR_DES]
		  ,[CO_DOC_VEN_DES]
		  ,[CO_DOC_VEN_POR_IVA]
		  ,[CO_DOC_VEN_IVA]
		  ,[CO_DOC_VEN_TOT_PAG]
		  ,[CO_DOC_VEN_GUI_NUM]
		  ,[CO_DOC_VEN_GUI_FEC_INI]
		  ,[CO_DOC_VEN_GUI_FEC_TER]
		  ,[CO_DOC_VEN_GUI_TIP]
		  ,[CO_DOC_VEN_GUI_NOM_TRA]
		  ,[CO_DOC_VEN_GUI_IDE]
		  ,[CO_EMP_RUC]
		  ,[CO_DOC_VEN_NUM]
		  ,[CO_TIP_DOC_VEN_NUM]
		  ,[CO_FAM_ART_COD] as [CO_DET_DOC_VEN_ART_COD]
		  ,[CO_FAM_ART_NOM] as [CO_DET_DOC_VEN_ART_NOM]
		  ,SUM([CO_DET_DOC_VEN_CAN]) AS CO_DET_DOC_VEN_CAN
		  ,SUM([CO_DET_DOC_VEN_PRE]) AS CO_DET_DOC_VEN_PRE
		  ,SUM([CO_DET_DOC_VEN_TOT]) AS CO_DET_DOC_VEN_TOT
		  ,[CO_EMP_NOM]
		  ,[CO_EMP_CIU]
		  ,[CO_EMP_DIR]
		  ,[CO_DOC_VEN_VAL_IVA0]
		  ,[CO_VEN_NOM]
		  ,[CO_FAM_ART_COD] as [CO_DET_DOC_VEN_ART_BAR]
		  ,[CO_DOC_VEN_OTR]
		  ,[CO_DOC_VEN_DET]
		  ,[CO_CANTIDAD_EMPAQUE]
		  ,[CO_EMPRESA_LOGO]
		  ,[CO_OBLIGADO_CONTABILIDAD]
		  ,[CO_CONTRIBUYENTE_ESPECIAL]
		  ,[CO_CONTRIBUYENTE_NUMERO]
		  ,[CO_EMP_RAZ_SOC]
		  ,[CO_DET_DOC_VEN_DES]
		  ,[CO_CODIGO_BARRAS_FACT_ELECTRONICA]
		  ,[CO_CLAVE_ACCESO_FACT_ELECTRONICA]
		  ,[CO_FECHA_AUTORIZA_FACT_ELECTRONICA]
		  ,[CO_DOC_VEN_MOD_NUM]
		  ,[CO_DOC_VEN_FEC_MOD]
		  ,CO_EMP_TEL
	FROM CO_VW_SELECT_REPORTE_DOCUMENTO_VENTA
	WHERE CO_EMP_RUC=@CO_EMP_RUC AND CO_DOC_VEN_NUM=@CO_DOC_VEN_NUM AND CO_TIP_DOC_VEN_NUM=@CO_TIP_DOC_VEN_NUM
	group by [CO_CLI_NOM]
		  ,[CO_CLI_COD]
		  ,[CO_CLI_CED]
		  ,[CO_CLI_TEL]
		  ,[CO_CLI_DIR]
		  ,[CO_CLI_CIU]
		  ,[CO_CLI_MAI]
		  ,[CO_DOC_VEN_FEC]
		  ,[CO_DOC_VEN_FOR_PAG]
		  ,[CO_DOC_VEN_TOT_LET]
		  ,[CO_DOC_VEN_TOT_NET]
		  ,[CO_DOC_VEN_POR_DES]
		  ,[CO_DOC_VEN_DES]
		  ,[CO_DOC_VEN_POR_IVA]
		  ,[CO_DOC_VEN_IVA]
		  ,[CO_DOC_VEN_TOT_PAG]
		  ,[CO_DOC_VEN_GUI_NUM]
		  ,[CO_DOC_VEN_GUI_FEC_INI]
		  ,[CO_DOC_VEN_GUI_FEC_TER]
		  ,[CO_DOC_VEN_GUI_TIP]
		  ,[CO_DOC_VEN_GUI_NOM_TRA]
		  ,[CO_DOC_VEN_GUI_IDE]
		  ,[CO_EMP_RUC]
		  ,[CO_DOC_VEN_NUM]
		  ,[CO_TIP_DOC_VEN_NUM]
		  ,[CO_FAM_ART_COD]
		  ,[CO_FAM_ART_NOM]
		  ,[CO_EMP_NOM]
		  ,[CO_EMP_CIU]
		  ,[CO_EMP_DIR]
		  ,[CO_DOC_VEN_VAL_IVA0]
		  ,[CO_VEN_NOM]
		  ,[CO_FAM_ART_COD]
		  ,[CO_DOC_VEN_OTR]
		  ,[CO_DOC_VEN_DET]
		  ,[CO_CANTIDAD_EMPAQUE]
		  ,[CO_EMPRESA_LOGO]
		  ,[CO_OBLIGADO_CONTABILIDAD]
		  ,[CO_CONTRIBUYENTE_ESPECIAL]
		  ,[CO_CONTRIBUYENTE_NUMERO]
		  ,[CO_EMP_RAZ_SOC]
		  ,[CO_DET_DOC_VEN_DES]
		  ,[CO_CODIGO_BARRAS_FACT_ELECTRONICA]
		  ,[CO_CLAVE_ACCESO_FACT_ELECTRONICA]
		  ,[CO_FECHA_AUTORIZA_FACT_ELECTRONICA]
		  ,[CO_DOC_VEN_MOD_NUM]
		  ,[CO_DOC_VEN_FEC_MOD]
		  ,CO_EMP_TEL
	ORDER BY [CO_DET_DOC_VEN_ART_COD]
end
GO
